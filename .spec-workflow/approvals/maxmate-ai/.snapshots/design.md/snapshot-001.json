{
  "id": "snapshot_1765355190510_d3gxga8m6",
  "approvalId": "approval_1765355190498_ss5ooef92",
  "approvalTitle": "MaxMate.ai Technical Design Document - 技术设计文档",
  "version": 1,
  "timestamp": "2025-12-10T08:26:30.510Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# MaxMate.ai - Technical Design Document\n\n## 1. Overview\n\n本文档定义 MaxMate.ai 的技术架构、数据流、API 设计和组件结构。\n\n### 1.1 系统架构概览\n\n```\n┌─────────────────────────────────────────────────────────────────────────────┐\n│                              CLIENT LAYER                                    │\n│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │\n│  │   Homepage  │  │  Onboarding │  │   Loading   │  │  Dashboard  │        │\n│  │   (SSG)     │  │   (CSR)     │  │   (CSR)     │  │   (SSG)     │        │\n│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘        │\n│         │                │                │                │                │\n│         └────────────────┴────────────────┴────────────────┘                │\n│                                   │                                         │\n│                          Next.js 15 App Router                              │\n│                          (React Server Components)                          │\n└─────────────────────────────────────────────────────────────────────────────┘\n                                    │\n                                    ▼\n┌─────────────────────────────────────────────────────────────────────────────┐\n│                              API LAYER                                       │\n│  ┌─────────────────────────────────────────────────────────────────────┐   │\n│  │                     FastAPI Backend                                  │   │\n│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐              │   │\n│  │  │ /api/generate│  │ /api/toolkit │  │  /api/user   │              │   │\n│  │  │   Toolkit    │  │    CRUD      │  │   Auth       │              │   │\n│  │  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘              │   │\n│  │         │                 │                 │                       │   │\n│  │         └─────────────────┴─────────────────┘                       │   │\n│  │                           │                                         │   │\n│  │                    Pydantic Validation                              │   │\n│  └─────────────────────────────────────────────────────────────────────┘   │\n└─────────────────────────────────────────────────────────────────────────────┘\n                                    │\n                                    ▼\n┌─────────────────────────────────────────────────────────────────────────────┐\n│                           AI/LLM LAYER                                       │\n│  ┌─────────────────────────────────────────────────────────────────────┐   │\n│  │                     Model Gateway                                    │   │\n│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐              │   │\n│  │  │  OpenAI      │  │   Gemini     │  │   Claude     │              │   │\n│  │  │  GPT-4       │  │   Pro        │  │   Sonnet     │              │   │\n│  │  └──────────────┘  └──────────────┘  └──────────────┘              │   │\n│  │         │                 │                 │                       │   │\n│  │         └─────────────────┴─────────────────┘                       │   │\n│  │                           │                                         │   │\n│  │                    Prompt Manager                                   │   │\n│  │                   (YAML Templates)                                  │   │\n│  └─────────────────────────────────────────────────────────────────────┘   │\n└─────────────────────────────────────────────────────────────────────────────┘\n                                    │\n                                    ▼\n┌─────────────────────────────────────────────────────────────────────────────┐\n│                           DATA LAYER                                         │\n│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐                      │\n│  │   Supabase   │  │    Redis     │  │   Pinecone   │                      │\n│  │  (PostgreSQL)│  │   (Cache)    │  │  (Vectors)   │                      │\n│  │              │  │              │  │              │                      │\n│  │  - Users     │  │  - Sessions  │  │  - Tools DB  │                      │\n│  │  - Toolkits  │  │  - Rate Limit│  │  - Embeddings│                      │\n│  │  - Tools     │  │              │  │              │                      │\n│  └──────────────┘  └──────────────┘  └──────────────┘                      │\n└─────────────────────────────────────────────────────────────────────────────┘\n```\n\n---\n\n## 2. Frontend Architecture (Next.js 15)\n\n### 2.1 目录结构\n\n```\nfrontend/\n├── app/\n│   ├── layout.tsx              # Root layout with metadata\n│   ├── page.tsx                # Homepage (SSG)\n│   ├── globals.css             # Global styles + Tailwind\n│   │\n│   ├── (auth)/                 # Auth route group\n│   │   ├── login/page.tsx\n│   │   └── register/page.tsx\n│   │\n│   ├── onboarding/             # Onboarding flow\n│   │   └── page.tsx            # Client component\n│   │\n│   ├── generate/               # Generation loading\n│   │   └── page.tsx            # Client component with polling\n│   │\n│   ├── u/                      # User toolkit pages\n│   │   └── [username]/\n│   │       └── page.tsx        # SSG with generateStaticParams\n│   │\n│   ├── directory/              # HTML Sitemap\n│   │   └── page.tsx            # SSG\n│   │\n│   ├── personas/               # Persona category hubs\n│   │   └── [profession]/\n│   │       └── page.tsx        # SSG\n│   │\n│   ├── api/                    # API Routes (Next.js)\n│   │   └── og/[username]/\n│   │       └── route.tsx       # Dynamic OG image generation\n│   │\n│   ├── sitemap.ts              # Dynamic sitemap\n│   └── robots.ts               # Robots.txt\n│\n├── components/\n│   ├── ui/                     # Shadcn UI components\n│   │   ├── button.tsx\n│   │   ├── card.tsx\n│   │   ├── input.tsx\n│   │   └── ...\n│   │\n│   ├── layout/                 # Layout components\n│   │   ├── navbar.tsx\n│   │   ├── footer.tsx\n│   │   └── breadcrumb.tsx\n│   │\n│   ├── homepage/               # Homepage specific\n│   │   ├── hero-section.tsx\n│   │   ├── search-input.tsx\n│   │   ├── feature-grid.tsx\n│   │   ├── trending-pills.tsx\n│   │   └── social-proof.tsx\n│   │\n│   ├── onboarding/             # Onboarding specific\n│   │   ├── progress-bar.tsx\n│   │   ├── hobby-grid.tsx\n│   │   ├── hobby-tag.tsx\n│   │   └── matching-indicator.tsx\n│   │\n│   ├── toolkit/                # Toolkit dashboard\n│   │   ├── toolkit-header.tsx\n│   │   ├── work-mode-section.tsx\n│   │   ├── life-mode-section.tsx\n│   │   ├── tool-card.tsx\n│   │   ├── hero-tool-card.tsx\n│   │   ├── kit-specs-sidebar.tsx\n│   │   └── related-toolkits.tsx\n│   │\n│   ├── seo/                    # SEO components\n│   │   ├── schema-markup.tsx\n│   │   ├── geo-box.tsx\n│   │   └── faq-section.tsx\n│   │\n│   └── animations/             # Motion components\n│       ├── stagger-container.tsx\n│       ├── fade-in.tsx\n│       ├── hover-card.tsx\n│       └── background-gradient.tsx\n│\n├── lib/\n│   ├── api.ts                  # API client functions\n│   ├── db.ts                   # Data fetching utilities\n│   ├── utils.ts                # Helper functions\n│   └── constants.ts            # App constants\n│\n├── hooks/\n│   ├── use-generation.ts       # Generation polling hook\n│   └── use-toolkit.ts          # Toolkit data hook\n│\n├── types/\n│   ├── toolkit.ts              # Toolkit types\n│   ├── tool.ts                 # Tool types\n│   └── user.ts                 # User types\n│\n└── public/\n    ├── icons/\n    └── images/\n```\n\n### 2.2 关键页面渲染策略\n\n| 页面 | 路由 | 渲染方式 | 原因 |\n|------|------|----------|------|\n| Homepage | `/` | SSG | SEO 关键，内容静态 |\n| Login/Register | `/login`, `/register` | CSR | 无 SEO 需求 |\n| Onboarding | `/onboarding` | CSR | 交互密集，无 SEO 需求 |\n| Generation | `/generate` | CSR | 实时轮询，无 SEO 需求 |\n| Toolkit Dashboard | `/u/[username]` | SSG | SEO 关键，`generateStaticParams` |\n| Directory | `/directory` | SSG | SEO 内链 |\n| Persona Hub | `/personas/[profession]` | SSG | SEO 分类页 |\n\n### 2.3 核心组件设计\n\n#### 2.3.1 SearchInput (Hero Section)\n\n```tsx\n// components/homepage/search-input.tsx\n\"use client\";\n\nimport { useState } from \"react\";\nimport { motion } from \"framer-motion\";\nimport { useRouter } from \"next/navigation\";\nimport { Search } from \"lucide-react\";\n\ninterface SearchInputProps {\n  placeholder?: string;\n}\n\nexport function SearchInput({ placeholder = \"I am a Product Manager who loves hiking...\" }: SearchInputProps) {\n  const [value, setValue] = useState(\"\");\n  const [isFocused, setIsFocused] = useState(false);\n  const router = useRouter();\n\n  const handleGenerate = () => {\n    if (value.trim()) {\n      // Store in sessionStorage for onboarding\n      sessionStorage.setItem(\"persona_input\", value);\n      router.push(\"/onboarding\");\n    }\n  };\n\n  return (\n    <motion.div\n      className=\"w-full max-w-[560px]\"\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n      transition={{ delay: 0.2 }}\n    >\n      <motion.label\n        className=\"flex h-16 rounded-full shadow-lg shadow-primary/20 overflow-hidden\"\n        animate={{\n          boxShadow: isFocused\n            ? \"0 10px 40px rgba(43, 108, 238, 0.3)\"\n            : \"0 10px 40px rgba(43, 108, 238, 0.1)\",\n        }}\n        transition={{ duration: 0.2 }}\n      >\n        <div className=\"flex items-center pl-6 bg-white dark:bg-slate-900\">\n          <Search className=\"w-5 h-5 text-slate-500\" />\n        </div>\n        <input\n          type=\"text\"\n          value={value}\n          onChange={(e) => setValue(e.target.value)}\n          onFocus={() => setIsFocused(true)}\n          onBlur={() => setIsFocused(false)}\n          onKeyDown={(e) => e.key === \"Enter\" && handleGenerate()}\n          placeholder={placeholder}\n          className=\"flex-1 px-4 bg-white dark:bg-slate-900 text-slate-900 dark:text-white placeholder:text-slate-500 focus:outline-none\"\n        />\n        <div className=\"flex items-center pr-2 bg-white dark:bg-slate-900\">\n          <motion.button\n            onClick={handleGenerate}\n            className=\"h-12 px-6 rounded-full bg-primary text-white font-bold\"\n            whileHover={{ scale: 1.05 }}\n            whileTap={{ scale: 0.98 }}\n          >\n            Generate\n          </motion.button>\n        </div>\n      </motion.label>\n    </motion.div>\n  );\n}\n```\n\n#### 2.3.2 HobbyGrid (Onboarding)\n\n```tsx\n// components/onboarding/hobby-grid.tsx\n\"use client\";\n\nimport { useState } from \"react\";\nimport { motion } from \"framer-motion\";\nimport { HobbyTag } from \"./hobby-tag\";\n\nconst HOBBIES = [\n  { id: \"hiking\", icon: \"hiking\", label: \"Hiking\" },\n  { id: \"gaming\", icon: \"stadia_controller\", label: \"Gaming\" },\n  { id: \"reading\", icon: \"book\", label: \"Reading\" },\n  { id: \"coding\", icon: \"code_blocks\", label: \"Coding\" },\n  { id: \"cooking\", icon: \"restaurant_menu\", label: \"Cooking\" },\n  { id: \"traveling\", icon: \"flight_takeoff\", label: \"Traveling\" },\n];\n\ninterface HobbyGridProps {\n  onSelectionChange: (selected: string[]) => void;\n}\n\nexport function HobbyGrid({ onSelectionChange }: HobbyGridProps) {\n  const [selected, setSelected] = useState<string[]>([]);\n\n  const toggleHobby = (id: string) => {\n    const newSelected = selected.includes(id)\n      ? selected.filter((s) => s !== id)\n      : [...selected, id];\n    setSelected(newSelected);\n    onSelectionChange(newSelected);\n  };\n\n  const container = {\n    hidden: { opacity: 0 },\n    show: {\n      opacity: 1,\n      transition: { staggerChildren: 0.05 },\n    },\n  };\n\n  const item = {\n    hidden: { opacity: 0, y: 10 },\n    show: { opacity: 1, y: 0 },\n  };\n\n  return (\n    <motion.div\n      className=\"grid grid-cols-2 sm:grid-cols-3 gap-3 sm:gap-4 p-4\"\n      variants={container}\n      initial=\"hidden\"\n      animate=\"show\"\n    >\n      {HOBBIES.map((hobby) => (\n        <motion.div key={hobby.id} variants={item}>\n          <HobbyTag\n            icon={hobby.icon}\n            label={hobby.label}\n            isSelected={selected.includes(hobby.id)}\n            onClick={() => toggleHobby(hobby.id)}\n          />\n        </motion.div>\n      ))}\n    </motion.div>\n  );\n}\n```\n\n#### 2.3.3 ToolCard (Toolkit Dashboard)\n\n```tsx\n// components/toolkit/tool-card.tsx\n\"use client\";\n\nimport { motion } from \"framer-motion\";\nimport Image from \"next/image\";\nimport { Star } from \"lucide-react\";\n\ninterface ToolCardProps {\n  tool: {\n    name: string;\n    logo: string;\n    rating: number;\n    description: string;\n    ctaText: string;\n    ctaUrl: string;\n  };\n}\n\nexport function ToolCard({ tool }: ToolCardProps) {\n  return (\n    <motion.article\n      className=\"flex flex-col gap-4 rounded-lg border border-gray-200 dark:border-gray-700/50 bg-white dark:bg-gray-800/30 p-5\"\n      whileHover={{\n        y: -4,\n        boxShadow: \"0 10px 30px rgba(0, 0, 0, 0.1)\",\n      }}\n      transition={{ type: \"spring\", stiffness: 300, damping: 20 }}\n    >\n      {/* Header */}\n      <div className=\"flex items-center gap-4\">\n        <Image\n          src={tool.logo}\n          alt={`${tool.name} logo`}\n          width={48}\n          height={48}\n          className=\"rounded-lg\"\n        />\n        <div>\n          <h3 className=\"text-lg font-bold text-gray-900 dark:text-white\">\n            {tool.name}\n          </h3>\n          <div className=\"flex items-center gap-1\">\n            {Array.from({ length: 5 }).map((_, i) => (\n              <Star\n                key={i}\n                className={`w-4 h-4 ${\n                  i < tool.rating\n                    ? \"text-yellow-400 fill-yellow-400\"\n                    : \"text-gray-300\"\n                }`}\n              />\n            ))}\n          </div>\n        </div>\n      </div>\n\n      {/* Description */}\n      <p className=\"text-sm text-gray-600 dark:text-gray-400 leading-relaxed flex-grow\">\n        {tool.description}\n      </p>\n\n      {/* CTA */}\n      <motion.a\n        href={tool.ctaUrl}\n        target=\"_blank\"\n        rel=\"noopener noreferrer\"\n        className=\"w-full text-center rounded-full bg-primary/20 text-primary font-semibold py-2 text-sm\"\n        whileHover={{ backgroundColor: \"rgba(43, 108, 238, 0.3)\" }}\n      >\n        {tool.ctaText}\n      </motion.a>\n    </motion.article>\n  );\n}\n```\n\n#### 2.3.4 SchemaMarkup (SEO)\n\n```tsx\n// components/seo/schema-markup.tsx\nimport { Toolkit, Tool } from \"@/types\";\n\ninterface SchemaMarkupProps {\n  toolkit: Toolkit;\n  tools: Tool[];\n}\n\nexport function SchemaMarkup({ toolkit, tools }: SchemaMarkupProps) {\n  const jsonLd = {\n    \"@context\": \"https://schema.org\",\n    \"@graph\": [\n      // CollectionPage\n      {\n        \"@type\": \"CollectionPage\",\n        \"name\": `${toolkit.userName}'s AI Stack: ${toolkit.workContext} & ${toolkit.lifeContext}`,\n        \"description\": toolkit.description,\n        \"url\": `https://maxmate.ai/u/${toolkit.slug}`,\n        \"mainEntity\": {\n          \"@type\": \"ItemList\",\n          \"numberOfItems\": tools.length,\n          \"itemListElement\": tools.map((tool, i) => ({\n            \"@type\": \"ListItem\",\n            \"position\": i + 1,\n            \"item\": {\n              \"@type\": \"SoftwareApplication\",\n              \"name\": tool.name,\n              \"applicationCategory\": tool.category,\n              \"description\": tool.description,\n              \"offers\": {\n                \"@type\": \"Offer\",\n                \"price\": tool.price || \"0\",\n                \"priceCurrency\": \"USD\",\n              },\n              \"aggregateRating\": {\n                \"@type\": \"AggregateRating\",\n                \"ratingValue\": tool.rating,\n                \"ratingCount\": tool.reviewCount || 100,\n              },\n            },\n          })),\n        },\n      },\n      // FAQPage\n      {\n        \"@type\": \"FAQPage\",\n        \"mainEntity\": toolkit.faq?.map((f) => ({\n          \"@type\": \"Question\",\n          \"name\": f.question,\n          \"acceptedAnswer\": {\n            \"@type\": \"Answer\",\n            \"text\": f.answer,\n          },\n        })) || [],\n      },\n      // BreadcrumbList\n      {\n        \"@type\": \"BreadcrumbList\",\n        \"itemListElement\": [\n          {\n            \"@type\": \"ListItem\",\n            \"position\": 1,\n            \"name\": \"Home\",\n            \"item\": \"https://maxmate.ai\",\n          },\n          {\n            \"@type\": \"ListItem\",\n            \"position\": 2,\n            \"name\": \"Personas\",\n            \"item\": \"https://maxmate.ai/personas\",\n          },\n          {\n            \"@type\": \"ListItem\",\n            \"position\": 3,\n            \"name\": toolkit.profession,\n            \"item\": `https://maxmate.ai/personas/${toolkit.professionSlug}`,\n          },\n          {\n            \"@type\": \"ListItem\",\n            \"position\": 4,\n            \"name\": `${toolkit.userName}'s Kit`,\n          },\n        ],\n      },\n    ],\n  };\n\n  return (\n    <script\n      type=\"application/ld+json\"\n      dangerouslySetInnerHTML={{ __html: JSON.stringify(jsonLd) }}\n    />\n  );\n}\n```\n\n---\n\n## 3. Backend Architecture (FastAPI)\n\n### 3.1 目录结构\n\n```\nbackend/\n├── app/\n│   ├── __init__.py\n│   ├── main.py                 # FastAPI app entry\n│   ├── config.py               # Environment config\n│   │\n│   ├── api/\n│   │   ├── __init__.py\n│   │   ├── deps.py             # Dependencies (auth, db)\n│   │   ├── v1/\n│   │   │   ├── __init__.py\n│   │   │   ├── router.py       # API router aggregator\n│   │   │   ├── generate.py     # /api/v1/generate\n│   │   │   ├── toolkit.py      # /api/v1/toolkit\n│   │   │   ├── user.py         # /api/v1/user\n│   │   │   └── tools.py        # /api/v1/tools\n│   │   └── health.py           # Health check endpoint\n│   │\n│   ├── models/\n│   │   ├── __init__.py\n│   │   ├── user.py             # User SQLAlchemy model\n│   │   ├── toolkit.py          # Toolkit model\n│   │   └── tool.py             # Tool model\n│   │\n│   ├── schemas/\n│   │   ├── __init__.py\n│   │   ├── user.py             # User Pydantic schemas\n│   │   ├── toolkit.py          # Toolkit schemas\n│   │   ├── tool.py             # Tool schemas\n│   │   └── generation.py       # Generation request/response\n│   │\n│   ├── services/\n│   │   ├── __init__.py\n│   │   ├── generation.py       # Toolkit generation logic\n│   │   ├── toolkit.py          # Toolkit CRUD\n│   │   └── user.py             # User service\n│   │\n│   ├── llm/\n│   │   ├── __init__.py\n│   │   ├── gateway.py          # Model Gateway (factory)\n│   │   ├── providers/\n│   │   │   ├── __init__.py\n│   │   │   ├── openai.py       # OpenAI provider\n│   │   │   ├── gemini.py       # Google Gemini provider\n│   │   │   └── anthropic.py    # Anthropic Claude provider\n│   │   └── prompts/\n│   │       ├── __init__.py\n│   │       ├── manager.py      # Prompt template manager\n│   │       └── templates/\n│   │           ├── base_system.yaml\n│   │           ├── toolkit_generation.yaml\n│   │           └── tool_matching.yaml\n│   │\n│   ├── db/\n│   │   ├── __init__.py\n│   │   ├── session.py          # Database session\n│   │   └── base.py             # SQLAlchemy base\n│   │\n│   └── core/\n│       ├── __init__.py\n│       ├── security.py         # JWT, password hashing\n│       └── exceptions.py       # Custom exceptions\n│\n├── tests/\n│   ├── __init__.py\n│   ├── conftest.py\n│   ├── test_generate.py\n│   └── test_toolkit.py\n│\n├── requirements.txt\n├── Dockerfile\n└── docker-compose.yml\n```\n\n### 3.2 API 端点设计\n\n#### 3.2.1 Generation API\n\n```python\n# app/api/v1/generate.py\nfrom fastapi import APIRouter, Depends, BackgroundTasks\nfrom app.schemas.generation import GenerationRequest, GenerationResponse, GenerationStatus\nfrom app.services.generation import GenerationService\nfrom app.api.deps import get_current_user_optional\n\nrouter = APIRouter(prefix=\"/generate\", tags=[\"generation\"])\n\n@router.post(\"/\", response_model=GenerationResponse)\nasync def create_generation(\n    request: GenerationRequest,\n    background_tasks: BackgroundTasks,\n    user = Depends(get_current_user_optional),\n):\n    \"\"\"\n    Start toolkit generation process.\n    Returns a job_id for polling status.\n    \"\"\"\n    service = GenerationService()\n    job_id = await service.start_generation(\n        profession=request.profession,\n        hobbies=request.hobbies,\n        pain_points=request.pain_points,\n        user_id=user.id if user else None,\n    )\n    \n    # Start background generation\n    background_tasks.add_task(service.run_generation, job_id)\n    \n    return GenerationResponse(\n        job_id=job_id,\n        status=\"processing\",\n        message=\"Toolkit generation started\",\n    )\n\n\n@router.get(\"/{job_id}/status\", response_model=GenerationStatus)\nasync def get_generation_status(job_id: str):\n    \"\"\"\n    Poll generation status.\n    Returns progress percentage and toolkit when complete.\n    \"\"\"\n    service = GenerationService()\n    return await service.get_status(job_id)\n```\n\n#### 3.2.2 Toolkit API\n\n```python\n# app/api/v1/toolkit.py\nfrom fastapi import APIRouter, Depends, HTTPException\nfrom app.schemas.toolkit import ToolkitResponse, ToolkitCreate, ToolkitUpdate\nfrom app.services.toolkit import ToolkitService\nfrom app.api.deps import get_current_user\n\nrouter = APIRouter(prefix=\"/toolkit\", tags=[\"toolkit\"])\n\n@router.get(\"/{username}\", response_model=ToolkitResponse)\nasync def get_toolkit_by_username(username: str):\n    \"\"\"Get public toolkit by username slug.\"\"\"\n    service = ToolkitService()\n    toolkit = await service.get_by_username(username)\n    if not toolkit:\n        raise HTTPException(status_code=404, detail=\"Toolkit not found\")\n    return toolkit\n\n\n@router.post(\"/clone/{toolkit_id}\", response_model=ToolkitResponse)\nasync def clone_toolkit(\n    toolkit_id: str,\n    user = Depends(get_current_user),\n):\n    \"\"\"Clone an existing toolkit to user's account.\"\"\"\n    service = ToolkitService()\n    return await service.clone(toolkit_id, user.id)\n\n\n@router.put(\"/{toolkit_id}\", response_model=ToolkitResponse)\nasync def update_toolkit(\n    toolkit_id: str,\n    data: ToolkitUpdate,\n    user = Depends(get_current_user),\n):\n    \"\"\"Update user's toolkit (add/remove tools).\"\"\"\n    service = ToolkitService()\n    return await service.update(toolkit_id, user.id, data)\n```\n\n### 3.3 Pydantic Schemas\n\n```python\n# app/schemas/generation.py\nfrom pydantic import BaseModel, Field\nfrom typing import List, Optional\nfrom enum import Enum\n\nclass GenerationRequest(BaseModel):\n    profession: str = Field(..., min_length=2, max_length=100, examples=[\"Product Manager\"])\n    hobbies: List[str] = Field(..., min_items=1, max_items=5, examples=[[\"hiking\", \"coding\"]])\n    pain_points: Optional[str] = Field(None, max_length=500)\n    \n    class Config:\n        json_schema_extra = {\n            \"example\": {\n                \"profession\": \"Product Manager\",\n                \"hobbies\": [\"hiking\", \"coding\"],\n                \"pain_points\": \"Need help with sprint planning and documentation\"\n            }\n        }\n\n\nclass GenerationStatus(BaseModel):\n    job_id: str\n    status: str  # \"processing\" | \"completed\" | \"failed\"\n    progress: int = Field(ge=0, le=100)\n    message: Optional[str] = None\n    toolkit_id: Optional[str] = None  # Set when completed\n    toolkit_slug: Optional[str] = None\n\n\n# app/schemas/toolkit.py\nfrom pydantic import BaseModel, Field\nfrom typing import List, Optional\nfrom datetime import datetime\n\nclass ToolInToolkit(BaseModel):\n    id: str\n    name: str\n    logo: str\n    rating: float\n    description: str\n    category: str  # \"work\" | \"life\"\n    price: Optional[float] = 0\n    cta_text: str\n    cta_url: str\n\n\nclass ToolkitResponse(BaseModel):\n    id: str\n    slug: str\n    user_name: str\n    profession: str\n    profession_slug: str\n    hobbies: List[str]\n    work_context: str\n    life_context: str\n    description: str\n    \n    work_tools: List[ToolInToolkit]\n    life_tools: List[ToolInToolkit]\n    \n    total_tools: int\n    monthly_cost: float\n    primary_goal: str\n    \n    faq: List[dict]\n    \n    created_at: datetime\n    updated_at: datetime\n    \n    class Config:\n        from_attributes = True\n```\n\n---\n\n## 4. LLM Integration Architecture\n\n### 4.1 Model Gateway (策略模式)\n\n```python\n# app/llm/gateway.py\nfrom abc import ABC, abstractmethod\nfrom typing import Dict, Any, Optional\nfrom app.llm.providers.openai import OpenAIProvider\nfrom app.llm.providers.gemini import GeminiProvider\nfrom app.llm.providers.anthropic import AnthropicProvider\nfrom app.config import settings\n\nclass LLMProvider(ABC):\n    \"\"\"Abstract base class for LLM providers.\"\"\"\n    \n    @abstractmethod\n    async def generate(self, prompt: str, schema: Optional[Dict] = None) -> Dict[str, Any]:\n        \"\"\"Generate response from LLM.\"\"\"\n        pass\n\n\nclass ModelGateway:\n    \"\"\"\n    Factory class for LLM provider selection.\n    Supports dynamic model switching and fallback.\n    \"\"\"\n    \n    PROVIDERS = {\n        \"openai\": OpenAIProvider,\n        \"gemini\": GeminiProvider,\n        \"anthropic\": AnthropicProvider,\n    }\n    \n    def __init__(\n        self,\n        provider: str = \"openai\",\n        model: str = \"gpt-4o\",\n        fallback_provider: Optional[str] = \"gemini\",\n    ):\n        self.provider = provider\n        self.model = model\n        self.fallback_provider = fallback_provider\n        self._client = self._create_client(provider, model)\n    \n    def _create_client(self, provider: str, model: str) -> LLMProvider:\n        provider_class = self.PROVIDERS.get(provider)\n        if not provider_class:\n            raise ValueError(f\"Unknown provider: {provider}\")\n        return provider_class(model=model)\n    \n    async def generate(self, prompt: str, schema: Optional[Dict] = None) -> Dict[str, Any]:\n        \"\"\"\n        Generate response with automatic fallback.\n        \"\"\"\n        try:\n            return await self._client.generate(prompt, schema)\n        except Exception as e:\n            if self.fallback_provider:\n                fallback_client = self._create_client(\n                    self.fallback_provider,\n                    settings.FALLBACK_MODEL,\n                )\n                return await fallback_client.generate(prompt, schema)\n            raise e\n```\n\n### 4.2 OpenAI Provider\n\n```python\n# app/llm/providers/openai.py\nfrom openai import AsyncOpenAI\nfrom typing import Dict, Any, Optional\nfrom app.llm.gateway import LLMProvider\nfrom app.config import settings\n\nclass OpenAIProvider(LLMProvider):\n    def __init__(self, model: str = \"gpt-4o\"):\n        self.model = model\n        self.client = AsyncOpenAI(api_key=settings.OPENAI_API_KEY)\n    \n    async def generate(self, prompt: str, schema: Optional[Dict] = None) -> Dict[str, Any]:\n        messages = [\n            {\"role\": \"system\", \"content\": \"You are a helpful AI assistant.\"},\n            {\"role\": \"user\", \"content\": prompt},\n        ]\n        \n        kwargs = {\n            \"model\": self.model,\n            \"messages\": messages,\n            \"temperature\": 0.7,\n        }\n        \n        # Use structured output if schema provided\n        if schema:\n            kwargs[\"response_format\"] = {\"type\": \"json_object\"}\n        \n        response = await self.client.chat.completions.create(**kwargs)\n        \n        content = response.choices[0].message.content\n        \n        if schema:\n            import json\n            return json.loads(content)\n        \n        return {\"content\": content}\n```\n\n### 4.3 Prompt Manager (模板化)\n\n```python\n# app/llm/prompts/manager.py\nimport yaml\nfrom pathlib import Path\nfrom typing import Dict, Any\nfrom jinja2 import Template\n\nclass PromptManager:\n    \"\"\"\n    Manages prompt templates stored in YAML files.\n    Supports variable injection via Jinja2.\n    \"\"\"\n    \n    TEMPLATES_DIR = Path(__file__).parent / \"templates\"\n    \n    def __init__(self):\n        self._cache: Dict[str, Dict] = {}\n    \n    def load_template(self, name: str) -> Dict[str, Any]:\n        \"\"\"Load prompt template from YAML file.\"\"\"\n        if name in self._cache:\n            return self._cache[name]\n        \n        file_path = self.TEMPLATES_DIR / f\"{name}.yaml\"\n        with open(file_path, \"r\", encoding=\"utf-8\") as f:\n            template = yaml.safe_load(f)\n        \n        self._cache[name] = template\n        return template\n    \n    def render(self, name: str, variables: Dict[str, Any]) -> str:\n        \"\"\"\n        Render prompt template with variables.\n        \"\"\"\n        template_data = self.load_template(name)\n        \n        # Build prompt from template sections\n        parts = []\n        \n        if \"role\" in template_data:\n            parts.append(f\"Role: {template_data['role']}\")\n        \n        if \"context\" in template_data:\n            context = Template(template_data[\"context\"]).render(**variables)\n            parts.append(f\"Context: {context}\")\n        \n        if \"task\" in template_data:\n            task = Template(template_data[\"task\"]).render(**variables)\n            parts.append(f\"Task: {task}\")\n        \n        if \"constraints\" in template_data:\n            constraints = \"\\n\".join(f\"- {c}\" for c in template_data[\"constraints\"])\n            parts.append(f\"Constraints:\\n{constraints}\")\n        \n        if \"output_format\" in template_data:\n            parts.append(f\"Output Format: {template_data['output_format']}\")\n        \n        return \"\\n\\n\".join(parts)\n```\n\n### 4.4 Prompt Templates (YAML)\n\n```yaml\n# app/llm/prompts/templates/toolkit_generation.yaml\nrole: |\n  You are MaxMate's Persona Engine™, an expert AI tool curator specializing in \n  matching AI tools to user profiles. You understand both professional workflows \n  and personal lifestyle optimization.\n\ncontext: |\n  User Profile:\n  - Profession: {{ profession }}\n  - Weekend Hobbies: {{ hobbies | join(', ') }}\n  - Pain Points: {{ pain_points or 'Not specified' }}\n\ntask: |\n  Select 10-15 AI tools that best match this user's profile.\n  Classify each tool into either \"Work Mode\" (Mon-Fri professional tasks) or \n  \"Life Mode\" (Weekend personal activities).\n  \n  For each tool, provide:\n  1. Why it matches the user's profession\n  2. How it addresses their pain points\n  3. Estimated time/cost savings\n\nconstraints:\n  - Include at least 2 free tools in each mode\n  - Work Mode tools must relate to {{ profession }} workflows\n  - Life Mode tools must relate to {{ hobbies | join(' or ') }}\n  - Descriptions must be 2-3 sentences explaining WHY this tool fits the user\n  - Total monthly cost should not exceed $100 for all tools combined\n\noutput_format: |\n  Return a valid JSON object with this structure:\n  {\n    \"work_tools\": [\n      {\n        \"name\": \"Tool Name\",\n        \"category\": \"work\",\n        \"description\": \"Why this tool is perfect for {{ profession }}s...\",\n        \"price\": 0,\n        \"rating\": 4.5\n      }\n    ],\n    \"life_tools\": [...],\n    \"kit_summary\": {\n      \"work_context\": \"SaaS Management & Team Collaboration\",\n      \"life_context\": \"Outdoor Adventure & Fitness\",\n      \"primary_goal\": \"Productivity\",\n      \"monthly_cost\": 45\n    },\n    \"faq\": [\n      {\n        \"question\": \"Why these specific tools for {{ profession }}s?\",\n        \"answer\": \"...\"\n      }\n    ]\n  }\n\nrecommended_model: gpt-4o\n```\n\n---\n\n## 5. Data Models\n\n### 5.1 Database Schema (PostgreSQL)\n\n```sql\n-- Users table\nCREATE TABLE users (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    email VARCHAR(255) UNIQUE NOT NULL,\n    password_hash VARCHAR(255) NOT NULL,\n    name VARCHAR(100),\n    avatar_url TEXT,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()\n);\n\n-- Toolkits table\nCREATE TABLE toolkits (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    user_id UUID REFERENCES users(id) ON DELETE CASCADE,\n    slug VARCHAR(100) UNIQUE NOT NULL,\n    \n    -- Profile data\n    profession VARCHAR(100) NOT NULL,\n    profession_slug VARCHAR(100) NOT NULL,\n    hobbies TEXT[] NOT NULL,\n    pain_points TEXT,\n    \n    -- Generated metadata\n    work_context VARCHAR(200),\n    life_context VARCHAR(200),\n    description TEXT,\n    primary_goal VARCHAR(50),\n    monthly_cost DECIMAL(10, 2) DEFAULT 0,\n    \n    -- SEO data\n    faq JSONB DEFAULT '[]',\n    \n    -- Timestamps\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    \n    -- Indexes\n    INDEX idx_toolkits_profession_slug (profession_slug),\n    INDEX idx_toolkits_user_id (user_id)\n);\n\n-- Tools master table (reference data)\nCREATE TABLE tools (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    name VARCHAR(100) NOT NULL,\n    slug VARCHAR(100) UNIQUE NOT NULL,\n    logo_url TEXT,\n    description TEXT,\n    category VARCHAR(50), -- e.g., \"productivity\", \"fitness\", \"cooking\"\n    pricing_model VARCHAR(20), -- \"free\", \"freemium\", \"paid\"\n    price_monthly DECIMAL(10, 2),\n    rating DECIMAL(2, 1) DEFAULT 4.0,\n    review_count INTEGER DEFAULT 0,\n    website_url TEXT,\n    \n    -- Vector embedding for RAG\n    embedding VECTOR(1536),\n    \n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()\n);\n\n-- Toolkit-Tools junction table\nCREATE TABLE toolkit_tools (\n    toolkit_id UUID REFERENCES toolkits(id) ON DELETE CASCADE,\n    tool_id UUID REFERENCES tools(id) ON DELETE CASCADE,\n    mode VARCHAR(10) NOT NULL CHECK (mode IN ('work', 'life')),\n    position INTEGER NOT NULL,\n    custom_description TEXT, -- User-customized or AI-generated description\n    \n    PRIMARY KEY (toolkit_id, tool_id)\n);\n\n-- Generation jobs table (for async processing)\nCREATE TABLE generation_jobs (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    user_id UUID REFERENCES users(id) ON DELETE SET NULL,\n    status VARCHAR(20) DEFAULT 'pending', -- pending, processing, completed, failed\n    progress INTEGER DEFAULT 0,\n    \n    -- Input data\n    input_data JSONB NOT NULL,\n    \n    -- Output data\n    toolkit_id UUID REFERENCES toolkits(id),\n    error_message TEXT,\n    \n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    completed_at TIMESTAMP WITH TIME ZONE\n);\n```\n\n### 5.2 TypeScript Types (Frontend)\n\n```typescript\n// types/toolkit.ts\nexport interface Toolkit {\n  id: string;\n  slug: string;\n  userName: string;\n  profession: string;\n  professionSlug: string;\n  hobbies: string[];\n  workContext: string;\n  lifeContext: string;\n  description: string;\n  \n  workTools: Tool[];\n  lifeTools: Tool[];\n  \n  totalTools: number;\n  monthlyCost: number;\n  primaryGoal: string;\n  \n  faq: FAQ[];\n  \n  createdAt: string;\n  updatedAt: string;\n}\n\n// types/tool.ts\nexport interface Tool {\n  id: string;\n  name: string;\n  slug: string;\n  logo: string;\n  description: string;\n  category: string;\n  pricingModel: \"free\" | \"freemium\" | \"paid\";\n  priceMonthly: number;\n  rating: number;\n  reviewCount: number;\n  websiteUrl: string;\n  \n  // Context-specific\n  customDescription?: string; // Why this tool matches the user\n  mode: \"work\" | \"life\";\n  position: number;\n}\n\n// types/user.ts\nexport interface User {\n  id: string;\n  email: string;\n  name: string;\n  avatarUrl?: string;\n  toolkits: ToolkitSummary[];\n}\n\nexport interface ToolkitSummary {\n  id: string;\n  slug: string;\n  workContext: string;\n  lifeContext: string;\n  toolCount: number;\n  updatedAt: string;\n}\n\n// types/api.ts\nexport interface GenerationRequest {\n  profession: string;\n  hobbies: string[];\n  painPoints?: string;\n}\n\nexport interface GenerationResponse {\n  jobId: string;\n  status: \"processing\" | \"completed\" | \"failed\";\n  message?: string;\n}\n\nexport interface GenerationStatus {\n  jobId: string;\n  status: \"processing\" | \"completed\" | \"failed\";\n  progress: number;\n  message?: string;\n  toolkitId?: string;\n  toolkitSlug?: string;\n}\n```\n\n---\n\n## 6. Animation System\n\n### 6.1 Motion Variants Library\n\n```typescript\n// lib/animations.ts\nimport { Variants } from \"framer-motion\";\n\n// Container variants for staggered children\nexport const staggerContainer: Variants = {\n  hidden: { opacity: 0 },\n  show: {\n    opacity: 1,\n    transition: {\n      staggerChildren: 0.1,\n      delayChildren: 0.1,\n    },\n  },\n};\n\n// Fade up animation for cards\nexport const fadeUp: Variants = {\n  hidden: { opacity: 0, y: 20 },\n  show: {\n    opacity: 1,\n    y: 0,\n    transition: { type: \"spring\", stiffness: 300, damping: 24 },\n  },\n};\n\n// Fade in from left (Work Mode section)\nexport const slideInLeft: Variants = {\n  hidden: { opacity: 0, x: -30 },\n  show: {\n    opacity: 1,\n    x: 0,\n    transition: { type: \"spring\", stiffness: 300, damping: 24 },\n  },\n};\n\n// Fade in from right (Life Mode section)\nexport const slideInRight: Variants = {\n  hidden: { opacity: 0, x: 30 },\n  show: {\n    opacity: 1,\n    x: 0,\n    transition: { type: \"spring\", stiffness: 300, damping: 24 },\n  },\n};\n\n// Scale on hover for interactive elements\nexport const hoverScale = {\n  scale: 1.05,\n  transition: { type: \"spring\", stiffness: 400, damping: 17 },\n};\n\n// Tap feedback\nexport const tapScale = {\n  scale: 0.98,\n};\n\n// Card hover with shadow\nexport const cardHover = {\n  y: -4,\n  boxShadow: \"0 10px 30px rgba(0, 0, 0, 0.1)\",\n  transition: { type: \"spring\", stiffness: 300, damping: 20 },\n};\n\n// Background gradient animation\nexport const gradientAnimation = {\n  background: [\n    \"linear-gradient(135deg, #f6f6f8 0%, #e8ebf0 100%)\",\n    \"linear-gradient(135deg, #e8ebf0 0%, #f6f6f8 100%)\",\n    \"linear-gradient(135deg, #f6f6f8 0%, #e8ebf0 100%)\",\n  ],\n  transition: {\n    duration: 8,\n    repeat: Infinity,\n    ease: \"linear\",\n  },\n};\n```\n\n### 6.2 Reusable Animation Components\n\n```tsx\n// components/animations/stagger-container.tsx\n\"use client\";\n\nimport { motion, HTMLMotionProps } from \"framer-motion\";\nimport { staggerContainer } from \"@/lib/animations\";\nimport { ReactNode } from \"react\";\n\ninterface StaggerContainerProps extends HTMLMotionProps<\"div\"> {\n  children: ReactNode;\n  className?: string;\n}\n\nexport function StaggerContainer({ children, className, ...props }: StaggerContainerProps) {\n  return (\n    <motion.div\n      variants={staggerContainer}\n      initial=\"hidden\"\n      animate=\"show\"\n      className={className}\n      {...props}\n    >\n      {children}\n    </motion.div>\n  );\n}\n\n\n// components/animations/fade-in.tsx\n\"use client\";\n\nimport { motion, HTMLMotionProps } from \"framer-motion\";\nimport { fadeUp } from \"@/lib/animations\";\nimport { ReactNode } from \"react\";\n\ninterface FadeInProps extends HTMLMotionProps<\"div\"> {\n  children: ReactNode;\n  className?: string;\n  delay?: number;\n}\n\nexport function FadeIn({ children, className, delay = 0, ...props }: FadeInProps) {\n  return (\n    <motion.div\n      variants={fadeUp}\n      initial=\"hidden\"\n      animate=\"show\"\n      transition={{ delay }}\n      className={className}\n      {...props}\n    >\n      {children}\n    </motion.div>\n  );\n}\n\n\n// components/animations/scroll-reveal.tsx\n\"use client\";\n\nimport { motion, HTMLMotionProps } from \"framer-motion\";\nimport { fadeUp } from \"@/lib/animations\";\nimport { ReactNode } from \"react\";\n\ninterface ScrollRevealProps extends HTMLMotionProps<\"div\"> {\n  children: ReactNode;\n  className?: string;\n}\n\nexport function ScrollReveal({ children, className, ...props }: ScrollRevealProps) {\n  return (\n    <motion.div\n      variants={fadeUp}\n      initial=\"hidden\"\n      whileInView=\"show\"\n      viewport={{ once: true, margin: \"-100px\" }}\n      className={className}\n      {...props}\n    >\n      {children}\n    </motion.div>\n  );\n}\n```\n\n---\n\n## 7. Environment Configuration\n\n### 7.1 Frontend (.env.local)\n\n```env\n# API\nNEXT_PUBLIC_API_URL=http://localhost:8000/api/v1\nNEXT_PUBLIC_SITE_URL=https://maxmate.ai\n\n# Analytics (optional)\nNEXT_PUBLIC_GA_ID=G-XXXXXXXXXX\n\n# Feature flags\nNEXT_PUBLIC_ENABLE_AUTH=true\n```\n\n### 7.2 Backend (.env)\n\n```env\n# App\nAPP_ENV=development\nDEBUG=true\n\n# Database\nDATABASE_URL=postgresql://user:password@localhost:5432/maxmate\n\n# Redis\nREDIS_URL=redis://localhost:6379\n\n# LLM Providers\nOPENAI_API_KEY=sk-...\nGOOGLE_API_KEY=...\nANTHROPIC_API_KEY=...\n\n# Default model settings\nDEFAULT_PROVIDER=openai\nDEFAULT_MODEL=gpt-4o\nFALLBACK_PROVIDER=gemini\nFALLBACK_MODEL=gemini-1.5-pro\n\n# JWT\nJWT_SECRET_KEY=your-secret-key\nJWT_ALGORITHM=HS256\nJWT_EXPIRATION_HOURS=24\n\n# Pinecone (Vector DB)\nPINECONE_API_KEY=...\nPINECONE_ENVIRONMENT=us-east-1\nPINECONE_INDEX=maxmate-tools\n```\n\n---\n\n## 8. Deployment Architecture\n\n```\n┌─────────────────────────────────────────────────────────────────────────────┐\n│                              PRODUCTION                                      │\n│                                                                             │\n│  ┌─────────────────────────────────────────────────────────────────────┐   │\n│  │                           Vercel                                     │   │\n│  │  ┌───────────────┐  ┌───────────────┐  ┌───────────────┐           │   │\n│  │  │   Next.js     │  │   Edge        │  │   ISR/SSG     │           │   │\n│  │  │   Frontend    │  │   Functions   │  │   Pages       │           │   │\n│  │  └───────────────┘  └───────────────┘  └───────────────┘           │   │\n│  └─────────────────────────────────────────────────────────────────────┘   │\n│                                    │                                         │\n│                                    ▼                                         │\n│  ┌─────────────────────────────────────────────────────────────────────┐   │\n│  │                         Railway / Render                             │   │\n│  │  ┌───────────────┐  ┌───────────────┐                              │   │\n│  │  │   FastAPI     │  │   Celery      │                              │   │\n│  │  │   Backend     │  │   Workers     │                              │   │\n│  │  └───────────────┘  └───────────────┘                              │   │\n│  └─────────────────────────────────────────────────────────────────────┘   │\n│                                    │                                         │\n│                                    ▼                                         │\n│  ┌─────────────────────────────────────────────────────────────────────┐   │\n│  │                         Managed Services                             │   │\n│  │  ┌───────────────┐  ┌───────────────┐  ┌───────────────┐           │   │\n│  │  │   Supabase    │  │   Upstash     │  │   Pinecone    │           │   │\n│  │  │   PostgreSQL  │  │   Redis       │  │   Vectors     │           │   │\n│  │  └───────────────┘  └───────────────┘  └───────────────┘           │   │\n│  └─────────────────────────────────────────────────────────────────────┘   │\n└─────────────────────────────────────────────────────────────────────────────┘\n```\n\n---\n\n## 9. Testing Strategy\n\n| 层级 | 工具 | 覆盖范围 |\n|------|------|----------|\n| Unit Tests | Jest / Vitest | Components, hooks, utils |\n| API Tests | pytest | FastAPI endpoints |\n| Integration | Playwright | User flows (E2E) |\n| Visual | Chromatic | Component regression |\n| Performance | Lighthouse CI | Core Web Vitals |\n\n---\n\n## 10. Security Considerations\n\n- **Input Validation**: All user inputs validated via Pydantic before LLM processing\n- **Rate Limiting**: 10 generations/hour for anonymous, 50 for authenticated\n- **API Keys**: All secrets in environment variables, never committed\n- **CORS**: Whitelist only production domains\n- **XSS Prevention**: React's default escaping + CSP headers\n- **SQL Injection**: SQLAlchemy ORM with parameterized queries\n\n",
  "fileStats": {
    "size": 49736,
    "lines": 1467,
    "lastModified": "2025-12-10T08:26:23.031Z"
  },
  "comments": []
}